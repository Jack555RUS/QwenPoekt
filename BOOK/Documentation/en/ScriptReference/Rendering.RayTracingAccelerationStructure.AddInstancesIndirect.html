<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    <script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836" data-dLayer-ignore="true" data-document-language="true">
    </script>
    <script type="text/javascript">function OptanonWrapper() {}</script>
    <script>window.dataLayer = window.dataLayer || []; dataLayer.push({ event: 'dataLayer-initialized', user: { user_unity_id: undefined, user_logged_in: 'no' }, environment: { environment_locale: 'en-us', environment_currency: undefined }});</script>
    <script>var offline=(location.href.indexOf('docs.unity3d.com')==-1)?true:false;if(!offline){(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);  })(window,document,'script','dataLayer','GTM-5V25JL6');}</script>
    <link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet" />
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Unity - Scripting API: Rendering.RayTracingAccelerationStructure.AddInstancesIndirect</title>
    <meta property="og:image" content="https://unity3d.com/files/images/ogimg.jpg" />
    <meta name="author" content="Unity Technologies" />
    <link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico" />
    <link rel="icon" type="image/png" href="../../../StaticFiles/images/favicons/favicon.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFiles/images/favicons/apple-touch-icon-152x152.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFiles/images/favicons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFiles/images/favicons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFiles/images/favicons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFiles/images/favicons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" href="../StaticFiles/images/favicons/apple-touch-icon.png" />
    <link rel="canonical" href="https://docs.unity3d.com/6000.3/Documentation/ScriptReference/Rendering.RayTracingAccelerationStructure.AddInstancesIndirect.html" />
    <meta name="msapplication-TileColor" content="#222c37" />
    <meta name="msapplication-TileImage" content="../StaticFiles/images/favicons/tileicon-144x144.png" />
    <script type="text/javascript" src="/StaticFilesConfig/UnityVersionsInfo.js">
    </script>
    <script type="text/javascript" src="../StaticFiles/js/jquery.js">
    </script>
    <script type="text/javascript" src="docdata/toc.js">//toc</script>
    <!--local TOC-->
    <script type="text/javascript" src="docdata/global_toc.js">//toc</script>
    <!--global TOC, including other platforms-->
    <script type="text/javascript" src="../StaticFiles/js/core.js">
    </script>
    <link rel="stylesheet" href="../StaticFiles/css/prism.css" />
    <script type="text/javascript" src="../StaticFiles/js/prism.js">
    </script>
    <link rel="stylesheet" type="text/css" href="../StaticFiles/css/core.css" />
    <script src="/StaticFilesConfig/feedback/feedback.js">
    </script>
    <script src="../StaticFiles/js/jquery.sidebar.min.js">
    </script>
    <script type="text/javascript" src="../StaticFiles/js/mobileoptimisation.js">
    </script>
    <link rel="stylesheet" href="../StaticFiles/css/mobileoptimisation.css" />
    <link rel="stylesheet" href="../StaticFiles/css/icons.css" />
  </head>
  <body>
    <div id="DocsAnalyticsData" data-area="none" data-pagetype="scriptref">
    </div>
    <div class="header-wrapper">
      <div id="header" class="header">
        <div class="content">
          <div class="spacer">
            <div class="menu">
              <div id="nav-open" for="nav-input">
                <span>
                </span>
              </div>
              <div class="logo">
                <a aria-label="go to the homepage" href="">
                </a>
              </div>
              <div class="search-form">
                <form action="30_search.html" method="get" class="apisearch">
                  <input type="text" name="q" aria-label="Search scripting documentation" placeholder="Search scripting..." autosave="Unity Reference" results="5" class="sbox field" id="q">
                  </input>
                  <input type="submit" class="submit">
                  </input>
                </form>
              </div>
              <ul>
                <li>
                  <a href="../Manual/index.html">Manual</a>
                </li>
                <li>
                  <a href="../ScriptReference/index.html" class="selected">Scripting API</a>
                </li>
              </ul>
            </div>
          </div>
          <div class="more">
            <div class="filler">
            </div>
            <ul>
              <li>
                <a href="https://unity.com/">unity.com</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="toolbar">
        <div class="content clear">
          <div class="toggle version-number" id="VersionNumber" data-target=".otherversionscontent">
                                Version: <b>Unity 6.3 LTS</b> (6000.3)
                                <div class="otherversionscontent" id="OtherVersionsContent" style="display: none;"><ul id="OtherVersionsContentUl"></ul><div id="otherVersionsLegend"><ul><li><div id="supportedColour" class="legendBox"></div>Supported</li><li><div id="notFoundColour" class="legendBox"></div>Legacy</li></ul></div></div><div id="VersionSwitcherArrow" class="arrow versionSwitcherArrow"></div></div>
          <div class="lang-switcher hide">
            <div class="current toggle" data-target=".lang-list">
              <div class="lbl">Language<span class="b">English</span></div>
              <div class="arrow">
              </div>
            </div>
            <div class="lang-list" style="display:none;">
              <ul>
                <li>
                  <a href="">English</a>
                </li>
              </ul>
            </div>
          </div>
          <div class="script-lang">
            <ul>
              <li class="selected" data-lang="CS">C#</li>
            </ul>
          </div>
          <div class="mobileLogo">
            <a aria-label="go to the homepage" href="https://docs.unity3d.com">
            </a>
          </div>
        </div>
      </div>
    </div>
    <div id="master-wrapper" class="master-wrapper clear">
      <div id="sidebar" class="sidebar">
        <div class="sidebar-wrap">
          <div class="content">
            <div class="sidebar-menu">
              <div class="toc" id="customScrollbar">
                <h2>Scripting API</h2>
                <div class="search-form sidebar-search-form">
                  <form action="30_search.html" method="get" class="apisearch">
                    <input type="text" name="q" aria-label="Search manual documentation" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q">
                    </input>
                    <input type="submit" id="mobileSearchBtn" class="submit" value="Search">
                    </input>
                  </form>
                </div>
                <div class="toggle version-number sidebar-version-switcher" id="VersionNumber" data-target=".otherversionscontent">
                  <form id="otherVersionsContentMobileForm">
                    <div class="ui-field-contain">
                      <label for="select-native-4">Version: Unity 6.3 LTS</label>
                      <select name="select-native-4" id="versionsSelectMobile">
                        <option>Select a different version</option>
                        <optgroup id="versionsWithThisPageMobile" label="Versions with this page">
                        </optgroup>
                        <optgroup id="versionsWithoutThisPageMobile" label="Versions without this page">
                        </optgroup>
                      </select>
                    </div>
                  </form>
                </div>
                <div class="lang-switcher hide">
                  <div class="toggle" data-target=".lang-list">
                    <div class="lbl">Language<span class="b">English</span></div>
                    <div class="arrow">
                    </div>
                  </div>
                  <div class="lang-list" style="display:none;">
                    <ul>
                      <li>
                        <a href="">English</a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="content-wrap" class="content-wrap">
        <div class="content-block">
          <div class="content">
            <div class="section">
              <div class="mb20 clear" id="">
                <h1 class="heading inherit">
                  <a href="Rendering.RayTracingAccelerationStructure.html" aria-label="Go to parent class: RayTracingAccelerationStructure">RayTracingAccelerationStructure</a>.AddInstancesIndirect</h1>
                <div class="clear">
                </div>
                <div class="scrollToFeedback">
                  <a id="scrollToFeedback" role="button" tabindex="0">Leave feedback</a>
                </div>
                <div class="clear">
                </div>
                <div class="suggest">
                  <a class="blue-btn sbtn">Suggest a change</a>
                  <div class="suggest-wrap rel hide">
                    <div class="loading hide">
                      <div>
                      </div>
                      <div>
                      </div>
                      <div>
                      </div>
                    </div>
                    <div class="suggest-success hide">
                      <h2>Success!</h2>
                      <p>Thank you for helping us improve the quality of Unity Documentation. Although we cannot accept all submissions, we do read each suggested change from our users and will make updates where applicable.</p>
                      <a class="gray-btn sbtn close">Close</a>
                    </div>
                    <div class="suggest-failed hide">
                      <h2>Submission failed</h2>
                      <p>For some reason your suggested change could not be submitted. Please &lt;a&gt;try again&lt;/a&gt; in a few minutes. And thank you for taking the time to help us improve the quality of Unity Documentation.</p>
                      <a class="gray-btn sbtn close">Close</a>
                    </div>
                    <div class="suggest-form clear">
                      <label for="suggest_name">Your name</label>
                      <input id="suggest_name" type="text">
                      </input>
                      <label for="suggest_email">Your email</label>
                      <input id="suggest_email" type="email">
                      </input>
                      <label for="suggest_body" class="clear">Suggestion<span class="r">*</span></label>
                      <textarea id="suggest_body" class="req">
                      </textarea>
                      <button id="suggest_submit" class="blue-btn mr10">Submit suggestion</button>
                      <p class="mb0">
                        <a class="cancel left lh42 cn">Cancel</a>
                      </p>
                    </div>
                  </div>
                </div>
                
                <div class="clear">
                </div>
              </div>
              <div class="subsection">
                <div class="signature">
                  <div class="signature-CS sig-block">
                    <span style="color:red;">
                    </span>
                    <h2>Declaration</h2>public int <span class="sig-kw">AddInstancesIndirect</span>(ref <a href="Rendering.RayTracingMeshInstanceConfig.html" aria-label="Go to Rendering.RayTracingMeshInstanceConfig page">Rendering.RayTracingMeshInstanceConfig</a> <span class="sig-kw">config</span>,
<a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer page">GraphicsBuffer</a> <span class="sig-kw">instanceMatrices</span>,
int <span class="sig-kw">maxInstanceCount</span>,
<a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer page">GraphicsBuffer</a> <span class="sig-kw">argsBuffer</span>,
uint <span class="sig-kw">argsOffset</span> = 0,
uint <span class="sig-kw">id</span>);
    </div>
                  <div class="signature-CS sig-block">
                    <span style="color:red;">
                    </span>
                    <h2>Declaration</h2>public int <span class="sig-kw">AddInstancesIndirect</span>(ref <a href="Rendering.RayTracingGeometryInstanceConfig.html" aria-label="Go to Rendering.RayTracingGeometryInstanceConfig page">Rendering.RayTracingGeometryInstanceConfig</a> <span class="sig-kw">config</span>,
<a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer page">GraphicsBuffer</a> <span class="sig-kw">instanceMatrices</span>,
int <span class="sig-kw">maxInstanceCount</span>,
<a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer page">GraphicsBuffer</a> <span class="sig-kw">argsBuffer</span>,
uint <span class="sig-kw">argsOffset</span> = 0,
uint <span class="sig-kw">id</span>);
    </div>
                </div>
              </div>
              <div class="subsection">
                <h3>Parameters</h3>
                <table class="list">
                  <thead>
                    <tr>
                      <th>Parameter</th>
                      <th>Description</th>
                    </tr>
                  </thead>
                  <tr>
                    <td class="name lbl">config</td>
                    <td class="desc">The common parameters that these ray tracing instances use.</td>
                  </tr>
                  <tr>
                    <td class="name lbl">instanceMatrices</td>
                    <td class="desc">The GraphicsBuffer to contain transformation matrices.</td>
                  </tr>
                  <tr>
                    <td class="name lbl">maxInstanceCount</td>
                    <td class="desc">The maximum number of ray tracing instances to add to the acceleration structure.</td>
                  </tr>
                  <tr>
                    <td class="name lbl">argsBuffer</td>
                    <td class="desc">The GraphicsBuffer containing 2 integer values at argsOffset byte offset: start instance and instance count.</td>
                  </tr>
                  <tr>
                    <td class="name lbl">argsOffset</td>
                    <td class="desc">The offset, in bytes, into argsBuffer where indirect arguments are stored.</td>
                  </tr>
                  <tr>
                    <td class="name lbl">id</td>
                    <td class="desc">An optional instance ID value that you can access in HLSL with the <code class="mono">InstanceID()</code> function. Unity assigns consecutive instance IDs to each mesh instance, starting with the value of <code class="mono">id</code>.</td>
                  </tr>
                </table>
              </div>
              <div class="subsection">
                <h3>Returns</h3>
                <p>
                  <strong>int</strong>
        The value representing a handle that you can use to perform later actions (e.g. <a href="Rendering.RayTracingAccelerationStructure.RemoveInstance.html" aria-label="Go to Rendering.RayTracingAccelerationStructure.RemoveInstance.html">RemoveInstance</a>), or 0 if the instances are not added successfully.
      </p>
              </div>
              <div class="subsection">
                <h3>Description</h3>
                <p>Adds an array of ray tracing instances to the acceleration structure where the instance matrices are specified using a GraphicsBuffer.</p>
              </div>
              <div class="subsection">
        <p>The <code class="mono">config</code> function argument specifies the relevant source geometry and associated parameters for all ray tracing instances. The source geometry can be either specified using a <a href="Mesh.html" aria-label="Go to Mesh.html">Mesh</a> or GraphicsBuffers containing vertex and index data.<br /><br />The world transformation matrices for ray tracing instances are specified using the instanceMatrices function argument. Only 4x4 floating-point matrices are supported where the elements are stored using column-major layout (the same as Matrix4x4 layout). The buffer must be created using the <a href="GraphicsBuffer.Target.Structured.html" aria-label="Go to GraphicsBuffer.Target.Structured.html">GraphicsBuffer.Target.Structured</a> or <a href="GraphicsBuffer.Target.Append.html" aria-label="Go to GraphicsBuffer.Target.Append.html">GraphicsBuffer.Target.Append</a> flags. You can specify the contents of the buffer by simply calling instanceMatrices.SetData(Matrix4x4[]) or you can employ a more advanced algorithm where the matrix buffer is filled in a compute shader in a GPU-driven rendering pipeline, for example.<br /><br />The <code class="mono">maxInstanceCount</code> argument is necessary to let Unity to allocate GPU memory for the acceleration structure (TLAS) used for ray tracing. The final number of valid ray tracing instances added to the acceleration structure depends on both the <code class="mono">maxInstanceCount</code> value and the <code class="mono">argsBuffer</code> values (start instance and instance count). An internal compute shader handles the process of adding instances. The compute shader is dispatched once for each <code class="mono">AddInstanceIndirect</code> call when the acceleration structure is built.<br /><br />When <code class="mono">AddInstancesIndirect</code> is used, Unity enables the <code class="mono">INSTANCING_ON</code> shader keyword. To declare the shader keyword in HLSL, add the line <code class="mono">#pragma multi_compile _ INSTANCING_ON</code> in the shader pass specified in <a href="Rendering.RayTracingShader.SetShaderPass.html" aria-label="Go to Rendering.RayTracingShader.SetShaderPass.html">RayTracingShader.SetShaderPass</a> or <a href="Rendering.CommandBuffer.SetRayTracingShaderPass.html" aria-label="Go to Rendering.CommandBuffer.SetRayTracingShaderPass.html">CommandBuffer.SetRayTracingShaderPass</a>.
To access per-instance data relative to this array of ray tracing instances, use <code class="mono">InstanceIndex() - unity_BaseInstanceID</code> to generate a zero-based instance index in hit shaders.<br /><br />When you have added all required instances, use <a href="Rendering.RayTracingAccelerationStructure.Build.html" aria-label="Go to Rendering.RayTracingAccelerationStructure.Build.html">RayTracingAccelerationStructure.Build</a> or <a href="Rendering.CommandBuffer.BuildRayTracingAccelerationStructure.html" aria-label="Go to Rendering.CommandBuffer.BuildRayTracingAccelerationStructure.html">CommandBuffer.BuildRayTracingAccelerationStructure</a> to build the acceleration structure on the GPU.<br /><br />This functionality doesn't have any special hardware requirements in addition to ray tracing support requirements (<a href="SystemInfo-supportsRayTracing.html" aria-label="Go to SystemInfo-supportsRayTracing.html">SystemInfo.supportsRayTracing</a> must be true). In DirectX Raytracing (DXR), this function causes all ray tracing instances in the array to use only one shader record from the shader table, which reduces the CPU overhead on the render thread for binding GPU resources to hit shaders.<br /><br />This method returns a single instance handle which you can use later to perform actions that affect all ray tracing instances added using this method.<br /><br />Additional resources: <a href="Rendering.RayTracingAccelerationStructure.RemoveInstance.html" aria-label="Go to Rendering.RayTracingAccelerationStructure.RemoveInstance.html">RayTracingAccelerationStructure.RemoveInstance</a>, <a href="Rendering.RayTracingAccelerationStructure.Build.html" aria-label="Go to Rendering.RayTracingAccelerationStructure.Build.html">RayTracingAccelerationStructure.Build</a>, <a href="GraphicsBuffer.CopyCount.html" aria-label="Go to GraphicsBuffer.CopyCount.html">GraphicsBuffer.CopyCount</a>.</p>
      </div>
              <hr class="section" />
              <div class="subsection">
                <div class="signature">
                  <div class="signature-CS sig-block">
                    <span style="color:red;">
                    </span>
                    <h2>Declaration</h2>public int <span class="sig-kw">AddInstancesIndirect</span>(ref <a href="Rendering.RayTracingMultiGeometryInstanceConfig.html" aria-label="Go to Rendering.RayTracingMultiGeometryInstanceConfig page">Rendering.RayTracingMultiGeometryInstanceConfig</a> <span class="sig-kw">config</span>,
<a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer page">GraphicsBuffer</a> <span class="sig-kw">instanceData</span>,
<a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer page">GraphicsBuffer</a> <span class="sig-kw">instanceIndices</span>,
int <span class="sig-kw">maxInstanceCount</span>,
<a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer page">GraphicsBuffer</a> <span class="sig-kw">argsBuffer</span>,
uint <span class="sig-kw">argsOffset</span> = 0,
uint <span class="sig-kw">id</span>);
    </div>
                  <div class="signature-CS sig-block">
                    <span style="color:red;">
                    </span>
                    <h2>Declaration</h2>public int <span class="sig-kw">AddInstancesIndirect</span>(ref <a href="Rendering.RayTracingMultiGeometryInstanceConfig.html" aria-label="Go to Rendering.RayTracingMultiGeometryInstanceConfig page">Rendering.RayTracingMultiGeometryInstanceConfig</a> <span class="sig-kw">config</span>,
<a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer page">GraphicsBuffer</a> <span class="sig-kw">instanceData</span>,
Type <span class="sig-kw">instanceType</span>,
<a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer page">GraphicsBuffer</a> <span class="sig-kw">instanceIndices</span>,
int <span class="sig-kw">maxInstanceCount</span>,
<a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer page">GraphicsBuffer</a> <span class="sig-kw">argsBuffer</span>,
uint <span class="sig-kw">argsOffset</span> = 0,
uint <span class="sig-kw">id</span>);
    </div>
                </div>
              </div>
              <div class="subsection">
                <h3>Parameters</h3>
                <table class="list">
                  <thead>
                    <tr>
                      <th>Parameter</th>
                      <th>Description</th>
                    </tr>
                  </thead>
                  <tr>
                    <td class="name lbl">config</td>
                    <td class="desc">The common parameters that these ray tracing instances use.</td>
                  </tr>
                  <tr>
                    <td class="name lbl">instanceData</td>
                    <td class="desc">The GraphicsBuffer to contain custom instance data.</td>
                  </tr>
                  <tr>
                    <td class="name lbl">instanceType</td>
                    <td class="desc">A type that you define in your scripts to describe the instance data format.</td>
                  </tr>
                  <tr>
                    <td class="name lbl">instanceIndices</td>
                    <td class="desc">An optional GraphicsBuffer that contains indices of ray tracing instances from instanceData to be added to the acceleration structure.</td>
                  </tr>
                  <tr>
                    <td class="name lbl">maxInstanceCount</td>
                    <td class="desc">The maximum number of ray tracing instances to add to the acceleration structure.</td>
                  </tr>
                  <tr>
                    <td class="name lbl">argsBuffer</td>
                    <td class="desc">The GraphicsBuffer containing 2 integer values at argsOffset byte offset: start instance and instance count.</td>
                  </tr>
                  <tr>
                    <td class="name lbl">argsOffset</td>
                    <td class="desc">The offset, in bytes, into argsBuffer where indirect arguments are stored.</td>
                  </tr>
                  <tr>
                    <td class="name lbl">id</td>
                    <td class="desc">An optional instance ID value that you can access in HLSL with the <code class="mono">InstanceID()</code> function. Unity assigns consecutive instance IDs to each mesh instance, starting with the value of <code class="mono">id</code>.</td>
                  </tr>
                </table>
              </div>
              <div class="subsection">
                <h3>Returns</h3>
                <p>
                  <strong>int</strong>
        The value representing a handle that you can use to perform later actions (e.g. <a href="Rendering.RayTracingAccelerationStructure.RemoveInstance.html" aria-label="Go to Rendering.RayTracingAccelerationStructure.RemoveInstance.html">RemoveInstance</a>), or 0 if the instances are not added successfully.
      </p>
              </div>
              <div class="subsection">
                <h3>Description</h3>
                <p>Adds an array of ray tracing instances to the acceleration structure where each instance can have a different transformation matrix, geometry and material.</p>
              </div>
              <div class="subsection">
        <p>The <code class="mono">config</code> function argument specifies the geometries, materials and other common parameters for all ray tracing instances. The source geometries can be specified using GraphicsBuffers containing vertex and index data. Use the <code class="mono">config.subGeometries</code> array to specify where each geometry starts and ends in the vertex and index buffers. You can easily use <a href="Mesh.html" aria-label="Go to Mesh.html">Mesh</a> data with this method by calling getter methods from the <a href="Mesh.html" aria-label="Go to Mesh.html">Mesh</a> class to retrieve the vertex and index buffers and associated data. Use the <code class="mono">config.materials</code> array to store the materials to be used by ray tracing instances. <br /><br />The <code class="mono">instanceData</code> buffer contains custom instance data. Each instance must contain the following mandatory data: the instance transformation matrix, an index into <code class="mono">config.subGeometries</code> to specify which geometry to use and an index into <code class="mono">config.materials</code> to specify which material to use. The transformation matrix must be a 4x4 floating-point matrix where the elements are stored using column-major layout (the same as Matrix4x4 layout). The geometry and material indices are represented using integer values. If the values are outside of their respective valid range, Unity clamps the values to the size of the <code class="mono">config.subGeometries</code> and <code class="mono">config.materials</code> respectively.<br /><br />To define the instance data format, pass a user-defined structure either as a generic type template argument or using the <code class="mono">instanceType</code> argument, for example by calling <code class="mono">AddInstancesIndirect&lt;MyInstanceData&gt;</code> or the equivalent, using <code class="mono">typeof(MyInstanceData)</code> for the <code class="mono">instanceType</code> argument. The structure can have any name and format but it needs to contain the following mandatory named fields: <code class="mono">objectToWorld</code>, <code class="mono">geometryIndex</code> and <code class="mono">materialIndex</code>. Unity throws an exception if any of these fields are not present in the structure that you provide.<br /><br />The <code class="mono">instanceIndices</code> buffer is optional and must be created using the <a href="GraphicsBuffer.Target.Structured.html" aria-label="Go to GraphicsBuffer.Target.Structured.html">GraphicsBuffer.Target.Structured</a> or <a href="GraphicsBuffer.Target.Append.html" aria-label="Go to GraphicsBuffer.Target.Append.html">GraphicsBuffer.Target.Append</a> flags. When using the <code class="mono">instanceIndices</code> buffer, the values in <code class="mono">argsBuffer</code> (startInstance and instanceCount) specify indices into this buffer instead of <code class="mono">instanceData</code> buffer. Use a <a href="GraphicsBuffer.Target.Append.html" aria-label="Go to GraphicsBuffer.Target.Append.html">GraphicsBuffer.Target.Append</a> flag if you append instance indices from a compute shader into <code class="mono">instanceIndices</code> buffer. In this case, call <a href="Rendering.CommandBuffer.CopyCounterValue.html" aria-label="Go to Rendering.CommandBuffer.CopyCounterValue.html">CommandBuffer.CopyCounterValue</a> or <a href="GraphicsBuffer.CopyCount.html" aria-label="Go to GraphicsBuffer.CopyCount.html">GraphicsBuffer.CopyCount</a> to copy the final instance count from <code class="mono">instanceIndices</code> into <code class="mono">argsBuffer</code>. This way, you can control the amount of instances to be added to the acceleration structure from a compute shader, for example by culling some of the instances.<br /><br />The <code class="mono">maxInstanceCount</code> argument is necessary to let Unity to allocate GPU memory for the acceleration structure (TLAS) used for ray tracing. The final number of valid ray tracing instances added to the acceleration structure depends on the <code class="mono">maxInstanceCount</code> value, the amount of indices in the <code class="mono">instanceIndices</code> buffer, and the <code class="mono">argsBuffer</code> values (start instance and instance count). An internal compute shader handles the process of adding instances. The compute shader is dispatched once for each <code class="mono">AddInstancesIndirect</code> call when the acceleration structure is built on the GPU.<br /><br />When <code class="mono">AddInstancesIndirect</code> is used, Unity enables the <code class="mono">INSTANCING_ON</code> shader keyword. To declare the shader keyword in HLSL, add the line <code class="mono">#pragma multi_compile _ INSTANCING_ON</code> in the shader pass specified in <a href="Rendering.RayTracingShader.SetShaderPass.html" aria-label="Go to Rendering.RayTracingShader.SetShaderPass.html">RayTracingShader.SetShaderPass</a> or <a href="Rendering.CommandBuffer.SetRayTracingShaderPass.html" aria-label="Go to Rendering.CommandBuffer.SetRayTracingShaderPass.html">CommandBuffer.SetRayTracingShaderPass</a>.
To access per-instance data relative to the array of ray tracing instances added using a single <code class="mono">AddInstancesIndirect</code> call, use <code class="mono">InstanceIndex() - unity_BaseInstanceID</code> to generate a zero-based instance index in hit shaders. If you need to access additional per-instance data in hit shader, use <code class="mono">config.materialProperties</code> to bind the data.<br /><br />Refer to the <code class="mono">GetMeshInfo</code> HLSL function from <code class="mono">UnityRayTracingMeshUtils.cginc</code> for more information about how to read vertex data from <code class="mono">config.vertexBuffer</code> in hit shaders. For every geometry in the <code class="mono">config.subGeometries</code> array, Unity prepares a <code class="mono">MeshInfo</code> entry into the built-in <code class="mono">unity_MeshInfo_RT</code> structured buffer. For every entry in <code class="mono">config.vertexAttributes</code> array, Unity prepares a <code class="mono">VertexAttributeInfo</code> entry into the built-in <code class="mono">unity_MeshVertexDeclaration_RT</code> structured buffer. <code class="mono">MeshInfo</code> and <code class="mono">VertexAttributesInfo</code> contain the basic information for reading vertex and index data in hit shaders.<br /><br />When you have added all required instances, use <a href="Rendering.RayTracingAccelerationStructure.Build.html" aria-label="Go to Rendering.RayTracingAccelerationStructure.Build.html">RayTracingAccelerationStructure.Build</a> or <a href="Rendering.CommandBuffer.BuildRayTracingAccelerationStructure.html" aria-label="Go to Rendering.CommandBuffer.BuildRayTracingAccelerationStructure.html">CommandBuffer.BuildRayTracingAccelerationStructure</a> to build the acceleration structure on the GPU.<br /><br />This functionality doesn't have any special hardware requirements in addition to ray tracing support requirements (<a href="SystemInfo-supportsRayTracing.html" aria-label="Go to SystemInfo-supportsRayTracing.html">SystemInfo.supportsRayTracing</a> must be true). In DirectX Raytracing (DXR), this function causes Unity to set up one shader record for each Material provided in the <code class="mono">config.materials</code> array, which reduces the CPU overhead on the render thread for binding GPU resources to hit shaders.<br /><br />This method returns a single instance handle which you can use later to perform actions that affect all ray tracing instances added using this method.<br /><br />Additional resources: <a href="Rendering.RayTracingAccelerationStructure.RemoveInstance.html" aria-label="Go to Rendering.RayTracingAccelerationStructure.RemoveInstance.html">RayTracingAccelerationStructure.RemoveInstance</a>, <a href="Rendering.RayTracingAccelerationStructure.Build.html" aria-label="Go to Rendering.RayTracingAccelerationStructure.Build.html">RayTracingAccelerationStructure.Build</a>, <a href="Mesh.GetVertexBuffer.html" aria-label="Go to Mesh.GetVertexBuffer.html">Mesh.GetVertexBuffer</a>, <a href="Mesh.GetIndexBuffer.html" aria-label="Go to Mesh.GetIndexBuffer.html">Mesh.GetIndexBuffer</a>, <a href="Mesh.GetVertexAttributes.html" aria-label="Go to Mesh.GetVertexAttributes.html">Mesh.GetVertexAttributes</a>.</p>
      </div>
              <div class="subsection">
        <pre class="codeExampleCS">using System.Collections.Generic;
using System.Runtime.InteropServices;
using Unity.Collections;
using UnityEngine;
using UnityEngine.Rendering;<br /><br />[<a href="ExecuteInEditMode.html" aria-label="Go to ExecuteInEditMode.html">ExecuteInEditMode</a>]
public class MeshInstancing : <a href="MonoBehaviour.html" aria-label="Go to MonoBehaviour.html">MonoBehaviour</a>
{
    [<a href="SerializeField.html" aria-label="Go to SerializeField.html">SerializeField</a>] <a href="Rendering.RayTracingShader.html" aria-label="Go to Rendering.RayTracingShader.html">RayTracingShader</a> rayTracingShader;<br /><br />    [<a href="SerializeField.html" aria-label="Go to SerializeField.html">SerializeField</a>] <a href="Material.html" aria-label="Go to Material.html">Material</a> material1;
    [<a href="SerializeField.html" aria-label="Go to SerializeField.html">SerializeField</a>] <a href="Material.html" aria-label="Go to Material.html">Material</a> material2;<br /><br />    private uint cameraWidth = 0;
    private uint cameraHeight = 0;<br /><br />    private int instanceRows = 100;
    private int instanceColumns = 100;<br /><br />    private <a href="RenderTexture.html" aria-label="Go to RenderTexture.html">RenderTexture</a> rayTracingOutput;<br /><br />    private <a href="Rendering.RayTracingAccelerationStructure.html" aria-label="Go to Rendering.RayTracingAccelerationStructure.html">RayTracingAccelerationStructure</a> rtas;<br /><br />    private <a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer.html">GraphicsBuffer</a> vertexBuffer;
    private <a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer.html">GraphicsBuffer</a> indexBuffer;
    private <a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer.html">GraphicsBuffer</a> instanceDataBuffer;
    private <a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer.html">GraphicsBuffer</a> indirectArgsBuffer;<br /><br />    private void ReleaseResources()
    {
        cameraWidth = 0;
        cameraHeight = 0;<br /><br />        if (rtas != null)
            rtas.Release();<br /><br />        if (rayTracingOutput != null)
            rayTracingOutput.Release();<br /><br />        if (vertexBuffer != null)
            vertexBuffer.Release();<br /><br />        if (indexBuffer != null)
            indexBuffer.Release();<br /><br />        if (instanceDataBuffer != null)
            instanceDataBuffer.Release();<br /><br />        if (indirectArgsBuffer != null)
            indirectArgsBuffer.Release();<br /><br />        rtas = null;
        rayTracingOutput = null;
        vertexBuffer = null;
        indexBuffer = null;
        instanceDataBuffer = null;
        indirectArgsBuffer = null;
    }<br /><br />    struct <a href="UIElements.Vertex.html" aria-label="Go to UIElements.Vertex.html">Vertex</a>
    {
        public <a href="UIElements.Vertex.html" aria-label="Go to UIElements.Vertex.html">Vertex</a>(<a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a> pos, <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a> n) { position = pos; normal = n; }
        public <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a> position;
        public <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a> normal;
    }<br /><br />    // objectToWorld, materialIndex, and geometryIndex fields are mandatory.
    public struct RayTracingPerInstanceData
    {
        public <a href="Matrix4x4.html" aria-label="Go to Matrix4x4.html">Matrix4x4</a> objectToWorld;
        public int data1;
        public uint materialIndex;
        public uint geometryIndex;
        public float data2;
        public <a href="Vector4.html" aria-label="Go to Vector4.html">Vector4</a> data3;
    };<br /><br />    private void CreateResources()
    {
        if (rtas == null)
        {
            RayTracingAccelerationStructure.Settings settings = new RayTracingAccelerationStructure.Settings
            {
                managementMode = <a href="Rendering.RayTracingAccelerationStructure.ManagementMode.Manual.html" aria-label="Go to Rendering.RayTracingAccelerationStructure.ManagementMode.Manual.html">RayTracingAccelerationStructure.ManagementMode.Manual</a>,
                rayTracingModeMask = <a href="Rendering.RayTracingAccelerationStructure.RayTracingModeMask.Everything.html" aria-label="Go to Rendering.RayTracingAccelerationStructure.RayTracingModeMask.Everything.html">RayTracingAccelerationStructure.RayTracingModeMask.Everything</a>,
                layerMask = -1,
                buildFlagsStaticGeometries = <a href="Rendering.RayTracingAccelerationStructureBuildFlags.PreferFastTrace.html" aria-label="Go to Rendering.RayTracingAccelerationStructureBuildFlags.PreferFastTrace.html">RayTracingAccelerationStructureBuildFlags.PreferFastTrace</a> | <a href="Rendering.RayTracingAccelerationStructureBuildFlags.MinimizeMemory.html" aria-label="Go to Rendering.RayTracingAccelerationStructureBuildFlags.MinimizeMemory.html">RayTracingAccelerationStructureBuildFlags.MinimizeMemory</a>,
                enableCompaction = true
            };
            rtas = new <a href="Rendering.RayTracingAccelerationStructure.html" aria-label="Go to Rendering.RayTracingAccelerationStructure.html">RayTracingAccelerationStructure</a>(settings);
        }<br /><br />        if (cameraWidth != Camera.main.pixelWidth || cameraHeight != Camera.main.pixelHeight)
        {
            if (rayTracingOutput != null)
                rayTracingOutput.Release();<br /><br />            rayTracingOutput = new <a href="RenderTexture.html" aria-label="Go to RenderTexture.html">RenderTexture</a>(Camera.main.pixelWidth, Camera.main.pixelHeight, 0, <a href="RenderTextureFormat.ARGBHalf.html" aria-label="Go to RenderTextureFormat.ARGBHalf.html">RenderTextureFormat.ARGBHalf</a>);
            rayTracingOutput.enableRandomWrite = true;
            rayTracingOutput.Create();<br /><br />            cameraWidth = (uint)Camera.main.pixelWidth;
            cameraHeight = (uint)Camera.main.pixelHeight;
        }<br /><br />        // The vertex and index buffers for the source geometry will be specified in <a href="Rendering.RayTracingMultiGeometryInstanceConfig-vertexBuffer.html" aria-label="Go to Rendering.RayTracingMultiGeometryInstanceConfig-vertexBuffer.html">RayTracingMultiGeometryInstanceConfig.vertexBuffer</a> and indexBuffer.
        // <a href="Audio.GeneratorInstance.Setup.html" aria-label="Go to Audio.GeneratorInstance.Setup.html">Setup</a> a vertex buffer that contains a quad and a triangle. The vertex contains the position and the normal.
        if (vertexBuffer == null)
        {
            List&lt;<a href="UIElements.Vertex.html" aria-label="Go to UIElements.Vertex.html">Vertex</a>&gt; vertices = new List&lt;<a href="UIElements.Vertex.html" aria-label="Go to UIElements.Vertex.html">Vertex</a>&gt;
            {
                // Add a quad.
                new <a href="UIElements.Vertex.html" aria-label="Go to UIElements.Vertex.html">Vertex</a>(new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(1, 0, -1), new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(0, 1, 0)),
                new <a href="UIElements.Vertex.html" aria-label="Go to UIElements.Vertex.html">Vertex</a>(new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(1, 0, 1), new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(0, 1, 0)),
                new <a href="UIElements.Vertex.html" aria-label="Go to UIElements.Vertex.html">Vertex</a>(new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(-1, 0, 1), new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(0, 1, 0)),
                new <a href="UIElements.Vertex.html" aria-label="Go to UIElements.Vertex.html">Vertex</a>(new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(-1, 0, -1), new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(0, 1, 0)),<br /><br />                // Add a triangle.
                new <a href="UIElements.Vertex.html" aria-label="Go to UIElements.Vertex.html">Vertex</a>(new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(1, 0, 0), new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(0, 0, 1)),
                new <a href="UIElements.Vertex.html" aria-label="Go to UIElements.Vertex.html">Vertex</a>(new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(-1, 0, 0), new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(0, 0, 1)),
                new <a href="UIElements.Vertex.html" aria-label="Go to UIElements.Vertex.html">Vertex</a>(new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(0, 3, 0), new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(0, 0, 1)),
            };<br /><br />            vertexBuffer = new <a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer.html">GraphicsBuffer</a>(<a href="GraphicsBuffer.Target.Raw.html" aria-label="Go to GraphicsBuffer.Target.Raw.html">GraphicsBuffer.Target.Raw</a> | <a href="GraphicsBuffer.Target.Vertex.html" aria-label="Go to GraphicsBuffer.Target.Vertex.html">GraphicsBuffer.Target.Vertex</a>, vertices.Count, Marshal.SizeOf(typeof(<a href="UIElements.Vertex.html" aria-label="Go to UIElements.Vertex.html">Vertex</a>)));
            vertexBuffer.SetData(vertices);
        }<br /><br />        // The geometry sub-ranges will be specified in <a href="Rendering.RayTracingMultiGeometryInstanceConfig-subGeometries.html" aria-label="Go to Rendering.RayTracingMultiGeometryInstanceConfig-subGeometries.html">RayTracingMultiGeometryInstanceConfig.subGeometries</a>.          
        if (indexBuffer == null)
        {
            List&lt;uint&gt; indices = new List&lt;uint&gt;()
            {
                 // 2 triangles for the quad.
                0, 1, 2, 0, 2, 3,<br /><br />                // 1 triangle.
                4, 5, 6,
            };<br /><br />            indexBuffer = new <a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer.html">GraphicsBuffer</a>(<a href="GraphicsBuffer.Target.Raw.html" aria-label="Go to GraphicsBuffer.Target.Raw.html">GraphicsBuffer.Target.Raw</a> | <a href="GraphicsBuffer.Target.Index.html" aria-label="Go to GraphicsBuffer.Target.Index.html">GraphicsBuffer.Target.Index</a>, indices.Count, sizeof(uint));
            indexBuffer.SetData(indices);
        }<br /><br />        if (instanceDataBuffer == null)
        {
            int instanceCount = instanceRows * instanceColumns;<br /><br />            // Generate a list of transformation matrices.
            NativeArray&lt;<a href="Matrix4x4.html" aria-label="Go to Matrix4x4.html">Matrix4x4</a>&gt; matrices = new NativeArray&lt;<a href="Matrix4x4.html" aria-label="Go to Matrix4x4.html">Matrix4x4</a>&gt;(instanceCount, <a href="Unity.Collections.Allocator.Temp.html" aria-label="Go to Unity.Collections.Allocator.Temp.html">Allocator.Temp</a>);<br /><br />            int index = 0;<br /><br />            <a href="Matrix4x4.html" aria-label="Go to Matrix4x4.html">Matrix4x4</a> m = <a href="Matrix4x4-identity.html" aria-label="Go to Matrix4x4-identity.html">Matrix4x4.identity</a>;<br /><br />            float angle = 0;<br /><br />            // Arrange the instances into a matrix.
            for (int row = 0; row &lt; instanceRows; row++)
            {
                float z = row + 0.5f - instanceRows * 0.5f;<br /><br />                for (int column = 0; column &lt; instanceColumns; column++)
                {
                    float x = column + 0.5f - instanceColumns * 0.5f;<br /><br />                    angle += 10.0f;<br /><br />                    <a href="Quaternion.html" aria-label="Go to Quaternion.html">Quaternion</a> rotation = <a href="Quaternion.Euler.html" aria-label="Go to Quaternion.Euler.html">Quaternion.Euler</a>(0, angle, 0);<br /><br />                    m.SetTRS(new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(5.5f * x, 4.001f, 5.5f * z), rotation, new <a href="Vector3.html" aria-label="Go to Vector3.html">Vector3</a>(2, 2, 2));<br /><br />                    matrices[index] = m;<br /><br />                    index++;
                }
            }<br /><br />            instanceDataBuffer = new <a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer.html">GraphicsBuffer</a>(<a href="GraphicsBuffer.Target.Raw.html" aria-label="Go to GraphicsBuffer.Target.Raw.html">GraphicsBuffer.Target.Raw</a>, instanceCount, Marshal.SizeOf(typeof(RayTracingPerInstanceData)));<br /><br />            RayTracingPerInstanceData[] perInstanceData = new RayTracingPerInstanceData[instanceCount];<br /><br />            <a href="Random.InitState.html" aria-label="Go to Random.InitState.html">Random.InitState</a>(12345);<br /><br />            for (int i = 0; i &lt; instanceCount; i++)
            {
                perInstanceData[i] = new RayTracingPerInstanceData
                {
                    // Assign a random geometry and material to each instance.
                    objectToWorld = matrices[i],
                    materialIndex = (uint)<a href="Random.Range.html" aria-label="Go to Random.Range.html">Random.Range</a>(0, 2),
                    geometryIndex = (uint)<a href="Random.Range.html" aria-label="Go to Random.Range.html">Random.Range</a>(0, 2),
                    data1 = i,
                    data2 = 3.14f,
                    data3 = new <a href="Vector4.html" aria-label="Go to Vector4.html">Vector4</a>(1, 2, 3, 4),
                };
            }<br /><br />            instanceDataBuffer.SetData(perInstanceData);
        }<br /><br />        if (indirectArgsBuffer == null)
        {
            indirectArgsBuffer = new <a href="GraphicsBuffer.html" aria-label="Go to GraphicsBuffer.html">GraphicsBuffer</a>(<a href="GraphicsBuffer.Target.Raw.html" aria-label="Go to GraphicsBuffer.Target.Raw.html">GraphicsBuffer.Target.Raw</a>, 1, 2 * sizeof(int));
            int[] ints = new int[2]
            {
                0,                               // instanceStart
                instanceRows * instanceColumns   // instanceCount
            };<br /><br />            indirectArgsBuffer.SetData(ints);
        }
    }<br /><br />    void OnDestroy()
    {
        ReleaseResources();
    }<br /><br />    void OnDisable()
    {
        ReleaseResources();
    }<br /><br />    [<a href="ImageEffectOpaque.html" aria-label="Go to ImageEffectOpaque.html">ImageEffectOpaque</a>]
    void OnRenderImage(<a href="RenderTexture.html" aria-label="Go to RenderTexture.html">RenderTexture</a> src, <a href="RenderTexture.html" aria-label="Go to RenderTexture.html">RenderTexture</a> dest)
    {
        if (<a href="SystemInfo-supportsRayTracing.html" aria-label="Go to SystemInfo-supportsRayTracing.html">SystemInfo.supportsRayTracing</a> == false)
        {
            <a href="Debug.Log.html" aria-label="Go to Debug.Log.html">Debug.Log</a>("The <a href="Ray.html" aria-label="Go to Ray.html">Ray</a> Tracing API is not supported by this GPU or by the current graphics API.");
            <a href="Graphics.Blit.html" aria-label="Go to Graphics.Blit.html">Graphics.Blit</a>(src, dest);
            return;
        }<br /><br />        if (rayTracingShader == null)
        {
            <a href="Debug.Log.html" aria-label="Go to Debug.Log.html">Debug.Log</a>("Please set the <a href="Rendering.RayTracingShader.html" aria-label="Go to Rendering.RayTracingShader.html">RayTracingShader</a>.");
            <a href="Graphics.Blit.html" aria-label="Go to Graphics.Blit.html">Graphics.Blit</a>(src, dest);
            return;
        }<br /><br />        CreateResources();<br /><br />        rtas.ClearInstances();<br /><br />        <a href="Rendering.CommandBuffer.html" aria-label="Go to Rendering.CommandBuffer.html">CommandBuffer</a> cmdBuffer = new <a href="Rendering.CommandBuffer.html" aria-label="Go to Rendering.CommandBuffer.html">CommandBuffer</a>();<br /><br />        <a href="Material.html" aria-label="Go to Material.html">Material</a>[] materials = new <a href="Material.html" aria-label="Go to Material.html">Material</a>[2];
        materials[0] = material1;
        materials[1] = material2;<br /><br />        <a href="Rendering.VertexAttributeDescriptor.html" aria-label="Go to Rendering.VertexAttributeDescriptor.html">VertexAttributeDescriptor</a>[] vertexDescs = new <a href="Rendering.VertexAttributeDescriptor.html" aria-label="Go to Rendering.VertexAttributeDescriptor.html">VertexAttributeDescriptor</a>[2];
        vertexDescs[0] = new <a href="Rendering.VertexAttributeDescriptor.html" aria-label="Go to Rendering.VertexAttributeDescriptor.html">VertexAttributeDescriptor</a>(<a href="Rendering.VertexAttribute.Position.html" aria-label="Go to Rendering.VertexAttribute.Position.html">VertexAttribute.Position</a>, <a href="Rendering.VertexAttributeFormat.Float32.html" aria-label="Go to Rendering.VertexAttributeFormat.Float32.html">VertexAttributeFormat.Float32</a>, 3, 0);
        vertexDescs[1] = new <a href="Rendering.VertexAttributeDescriptor.html" aria-label="Go to Rendering.VertexAttributeDescriptor.html">VertexAttributeDescriptor</a>(<a href="Rendering.VertexAttribute.Normal.html" aria-label="Go to Rendering.VertexAttribute.Normal.html">VertexAttribute.Normal</a>, <a href="Rendering.VertexAttributeFormat.Float32.html" aria-label="Go to Rendering.VertexAttributeFormat.Float32.html">VertexAttributeFormat.Float32</a>, 3, 0);<br /><br />        <a href="Rendering.RayTracingMultiGeometryInstanceConfig.html" aria-label="Go to Rendering.RayTracingMultiGeometryInstanceConfig.html">RayTracingMultiGeometryInstanceConfig</a> instances = new <a href="Rendering.RayTracingMultiGeometryInstanceConfig.html" aria-label="Go to Rendering.RayTracingMultiGeometryInstanceConfig.html">RayTracingMultiGeometryInstanceConfig</a>();<br /><br />        instances.vertexBuffer = vertexBuffer;
        instances.vertexAttributes = vertexDescs;
        instances.indexBuffer = indexBuffer;
        instances.materials = materials;
        instances.rayTracingMode = UnityEngine.Experimental.Rendering.RayTracingMode.Static;<br /><br />        // Configure the 2 geometries.
        // The geometries in this example are considered opaque. When cutout materials are used (for example foliage), use <a href="Rendering.RayTracingSubMeshFlags.Enabled.html" aria-label="Go to Rendering.RayTracingSubMeshFlags.Enabled.html">RayTracingSubMeshFlags.Enabled</a> flag alone to enable any hit shaders.
        instances.subGeometries = new <a href="Rendering.RayTracingSubGeometryDesc.html" aria-label="Go to Rendering.RayTracingSubGeometryDesc.html">RayTracingSubGeometryDesc</a>[2]
        {
            // The quad.
            new <a href="Rendering.RayTracingSubGeometryDesc.html" aria-label="Go to Rendering.RayTracingSubGeometryDesc.html">RayTracingSubGeometryDesc</a>
            {
                indexStart = 0,
                indexCount = 2 * 3,
                flags = <a href="Rendering.RayTracingSubMeshFlags.Enabled.html" aria-label="Go to Rendering.RayTracingSubMeshFlags.Enabled.html">RayTracingSubMeshFlags.Enabled</a> | <a href="Rendering.RayTracingSubMeshFlags.ClosestHitOnly.html" aria-label="Go to Rendering.RayTracingSubMeshFlags.ClosestHitOnly.html">RayTracingSubMeshFlags.ClosestHitOnly</a>
            },<br /><br />            // The triangle is right after the quad in the vertex buffer.
            new <a href="Rendering.RayTracingSubGeometryDesc.html" aria-label="Go to Rendering.RayTracingSubGeometryDesc.html">RayTracingSubGeometryDesc</a>()
            {
                indexStart = 2 * 3,
                indexCount = 3,
                flags = <a href="Rendering.RayTracingSubMeshFlags.Enabled.html" aria-label="Go to Rendering.RayTracingSubMeshFlags.Enabled.html">RayTracingSubMeshFlags.Enabled</a> | <a href="Rendering.RayTracingSubMeshFlags.ClosestHitOnly.html" aria-label="Go to Rendering.RayTracingSubMeshFlags.ClosestHitOnly.html">RayTracingSubMeshFlags.ClosestHitOnly</a>
            }
        };<br /><br />        // Not using instance indices in this example.
        // We add all the instances from instanceDataBuffer.
        rtas.AddInstancesIndirect&lt;RayTracingPerInstanceData&gt;(instances, instanceDataBuffer, null, -1, indirectArgsBuffer, 0);<br /><br />        cmdBuffer.BuildRayTracingAccelerationStructure(rtas);<br /><br />        cmdBuffer.SetRayTracingShaderPass(rayTracingShader, "Test");<br /><br />        // <a href="Input.html" aria-label="Go to Input.html">Input</a>
        cmdBuffer.SetRayTracingAccelerationStructure(rayTracingShader, <a href="Shader.PropertyToID.html" aria-label="Go to Shader.PropertyToID.html">Shader.PropertyToID</a>("g_AccelStruct"), rtas);
        cmdBuffer.SetRayTracingFloatParam(rayTracingShader, <a href="Shader.PropertyToID.html" aria-label="Go to Shader.PropertyToID.html">Shader.PropertyToID</a>("g_Zoom"), <a href="Mathf.Tan.html" aria-label="Go to Mathf.Tan.html">Mathf.Tan</a>(<a href="Mathf.Deg2Rad.html" aria-label="Go to Mathf.Deg2Rad.html">Mathf.Deg2Rad</a> * Camera.main.fieldOfView * 0.5f));<br /><br />        // Output
        cmdBuffer.SetRayTracingTextureParam(rayTracingShader, <a href="Shader.PropertyToID.html" aria-label="Go to Shader.PropertyToID.html">Shader.PropertyToID</a>("g_Output"), rayTracingOutput);<br /><br />        cmdBuffer.DispatchRays(rayTracingShader, "MainRayGenShader", cameraWidth, cameraHeight, 1);<br /><br />        <a href="Graphics.ExecuteCommandBuffer.html" aria-label="Go to Graphics.ExecuteCommandBuffer.html">Graphics.ExecuteCommandBuffer</a>(cmdBuffer);<br /><br />        cmdBuffer.Release();<br /><br />        <a href="Graphics.Blit.html" aria-label="Go to Graphics.Blit.html">Graphics.Blit</a>(rayTracingOutput, dest);
    }
}</pre>
      </div>
              <div class="subsection">
        <p>The script in this example calls AddInstancesIndirect&lt;T&gt; to add a number of ray tracing instances using random geometries and materials to an acceleration structure.</p>
      </div>
            </div>
            <div class="section">
              <div id="_content">
              </div>
            </div>
            <div class="footer-wrapper">
              <div class="footer clear">
                <div class="copy">
                  <p>
                    <known_issues>Is something described here not working as you expect it to? It might be a <b>Known Issue</b>. Please check with the Issue Tracker at </known_issues>
                    <a href="https://issuetracker.unity3d.com">issuetracker.unity3d.com</a>.</p>Copyright 2005-2026 Unity Technologies. All rights reserved. Built from job ID 63949192. Built on: 2026-02-25.
                                        </div>
                <div class="menu">
                  <a href="https://unity3d.com/learn">Tutorials</a>
                  <a href="https://answers.unity3d.com">Community Answers</a>
                  <a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a>
                  <a href="https://forum.unity3d.com">Forums</a>
                  <a href="https://unity3d.com/asset-store">Asset Store</a>
                  <a href="https://docs.unity3d.com/Manual/TermsOfUse.html">Terms of use</a>
                  <a href="https://unity.com/legal">Legal</a>
                  <a href="https://unity.com/legal/privacy-policy">Privacy Policy</a>
                  <a href="https://unity.com/legal/cookie-policy">Cookies</a>
                  <a href="https://unity.com/legal/do-not-sell-my-personal-information">Do Not Sell or Share My Personal Information</a>
                  <div id="ot-sdk-btn-container">
                    <a id="ot-sdk-btn" class="ot-sdk-show-settings" href="javascript:void(0);">Your Privacy Choices (Cookie Settings)</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>