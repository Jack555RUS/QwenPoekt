<!DOCTYPE html><html lang="en" class="no-js">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<script type="text/javascript" src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" charset="UTF-8" data-domain-script="6e91be4c-3145-4ea2-aa64-89d716064836" data-dLayer-ignore="true" data-document-language="true"></script><script type="text/javascript">function OptanonWrapper() {}</script><script>window.dataLayer = window.dataLayer || []; dataLayer.push({ event: 'dataLayer-initialized', user: { user_unity_id: undefined, user_logged_in: 'no' }, environment: { environment_locale: 'en-us', environment_currency: undefined }});</script><script>var offline=(location.href.indexOf('docs.unity3d.com')==-1)?true:false;if(!offline){(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=   'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);  })(window,document,'script','dataLayer','GTM-5V25JL6');}</script><link href="https://fonts.googleapis.com/css?family=Roboto&amp;display=swap" rel="stylesheet">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unity - Manual: Example: Create a generator</title>
<meta property="og:image" content="https://unity3d.com/files/images/ogimg.jpg">
<meta name="author" content="Unity Technologies">
<meta property="relative-path-to-manual" content="">
<meta property="version-switcher-versions-with-this-page" content="Versions with this page:">
<meta property="version-switcher-versions-without-this-page" content="Versions without this page:">
<meta property="version-switcher-supported" content="Supported">
<meta property="version-switcher-legacy" content="Legacy">
<link rel="shortcut icon" href="https://unity.com/themes/contrib/unity_base/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFilesManual/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFilesManual/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFilesManual/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFilesManual/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFilesManual/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFilesManual/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFilesManual/images/favicons/apple-touch-icon.png">
<link rel="canonical" href="https://docs.unity3d.com/6000.3/Documentation/Manual/audio-scriptable-processors-example-creating-a-generator.html">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFilesManual/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="/StaticFilesConfig/UnityVersionsInfo.js"></script><script type="text/javascript" src="../StaticFilesManual/js/jquery.js?ts=20260225"></script><script type="text/javascript" src="../StaticFilesManual/js/core.js?ts=20260225"></script><script type="text/javascript" src="../StaticFilesManual/js/image-comp.js?ts=20260225"></script><script type="text/javascript" src="docdata/toc.js?ts=20260225"></script><script type="text/javascript" src="docdata/global_toc.js?ts=20260225"></script><link rel="stylesheet" type="text/css" href="../StaticFilesManual/css/core.css?ts=20260225">
<link rel="stylesheet" type="text/css" href="../StaticFilesManual/css/icons.css?ts=20260225">
<link rel="stylesheet" href="../StaticFilesManual/css/prism.css">
<script src="../StaticFilesManual/js/prism.js"></script><script src="/StaticFilesConfig/feedback/feedback.js"></script><script src="../StaticFilesManual/js/jquery.sidebar.min.js"></script><link rel="stylesheet" href="../StaticFilesManual/css/mobileoptimisation.css">
<script src="../StaticFilesManual/js/mobileoptimisation.js"></script>
</head>
<body>
<div id="DocsAnalyticsData" data-area="none" data-pagetype="manual"></div>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div id="nav-open" for="nav-input"><span></span></div>
<div class="logo"><a aria-label="go to the homepage" href="https://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" aria-label="Search manual documentation" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul>
<li><a href="index.html" class="selected">Manual</a></li>
<li><a href="../ScriptReference/index.html">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity.com/">unity.com</a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="toggle version-number" id="VersionNumber" data-target=".otherversionscontent">
                                Version: <b>Unity 6.3 LTS</b> (6000.3)
                                <div class="otherversionscontent" id="OtherVersionsContent" style="display: none;">
<ul id="OtherVersionsContentUl"></ul>
<div id="otherVersionsLegend"><ul>
<li>
<div id="supportedColour" class="legendBox"></div>Supported</li>
<li>
<div id="notFoundColour" class="legendBox"></div>Legacy</li>
</ul></div>
</div>
<div id="VersionSwitcherArrow" class="arrow versionSwitcherArrow"></div>
</div>
<div class="lang-switcher"><div class="current toggle" data-target=".lang-list">
<div class="lbl">Language
:                <span class="b">English</span>
</div>
<div class="arrow"></div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/audio-scriptable-processors-example-creating-a-generator.html">English</a></li>
<li><a href="/cn/current/Manual/audio-scriptable-processors-example-creating-a-generator.html">中文</a></li>
<li><a href="/ja/current/Manual/audio-scriptable-processors-example-creating-a-generator.html">日本語</a></li>
<li><a href="/kr/current/Manual/audio-scriptable-processors-example-creating-a-generator.html">한국어</a></li>
</ul></div>
</div></div>
</div></div>
<div class="mobileLogo"><a aria-label="go to the homepage" href="https://docs.unity3d.com"></a></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc" id="customScrollbar">
<h2>Unity Manual</h2>
<div class="search-form sidebar-search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" aria-label="Search manual documentation" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" id="mobileSearchBtn" class="submit" value="Search">
</form></div>
<div class="toggle version-number sidebar-version-switcher" id="VersionNumber" data-target=".otherversionscontent"><form id="otherVersionsContentMobileForm"><div class="ui-field-contain">
<label for="select-native-4">Version: Unity 6.3 LTS</label><select name="select-native-4" id="versionsSelectMobile"><option>Select a different version</option>
<optgroup id="versionsWithThisPageMobile" label="Versions with this page"></optgroup>
<optgroup id="versionsWithoutThisPageMobile" label="Versions without this page"></optgroup></select>
</div></form></div>
<div class="lang-switcher"><div class="current toggle" data-target=".lang-list">
<div class="lbl">Language
:                <span class="b">English</span>
</div>
<div class="arrow"></div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/audio-scriptable-processors-example-creating-a-generator.html">English</a></li>
<li><a href="/cn/current/Manual/audio-scriptable-processors-example-creating-a-generator.html">中文</a></li>
<li><a href="/ja/current/Manual/audio-scriptable-processors-example-creating-a-generator.html">日本語</a></li>
<li><a href="/kr/current/Manual/audio-scriptable-processors-example-creating-a-generator.html">한국어</a></li>
</ul></div>
</div></div>
</div></div></div></div></div>
<div id="content-wrap" class="content-wrap"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="Audio.html">Audio</a></li>
<li><a href="audio-scriptable-processors.html">Scriptable audio pipeline</a></li>
<li>Example: Create a generator</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a aria-label="go to the previous page" href="audio-scriptable-processors-root-outputs.html"></a></span><div class="tip">Root Outputs</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a aria-label="go to the next page" href="audio-scriptable-processors-example-creating-a-root-output.html"></a></span><div class="tip">Example: Create a root output</div>
</div>
</div></div>
<div id="_leavefeedback"></div>
<h1>Example: Create a generator</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>This example walks through setting up a sine tone generator and attaching it to an <code>AudioSource</code> using the component-based workflow. It’s organized into two parts:</p>

<ul>
<li>
<strong>Part I (Minimal):</strong> Uses a fixed-frequency sine wave.</li>
<li>
<strong>Part II (Parameterized):</strong> Extends the minimal example with a frequency control.</li>
</ul>

<h2>Part I — Minimal example</h2>

<p>Implement <code>GeneratorInstance.IRealtime</code> to generate audio in <code>Process</code>. The real‑time struct holds the phase accumulator and precomputed increment.</p>

<pre><code class="lang-cs">[BurstCompile(CompileSynchronously = true)]
struct Realtime : GeneratorInstance.IRealtime
{
    private const float k_TwoPi = 2.0f * Mathf.PI;

    // Normalized phase accumulator in [0, 1).
    private float phase;

    // Precomputed phase step per sample (cycles per sample).
    internal float phaseIncrement;

    // Capabilities must match those reported from IAudioGenerator and IRealtime.
    public bool isFinite =&gt; false;
    public bool isRealtime =&gt; false;
    public DiscreteTime? length =&gt; null;

    // Called when the real-time side of the graph updates (e.g., new control data available).
    // Keep this method allocation-free and exception-free.
    public void Update(UpdatedDataContext context, Pipe pipe) { }

    public GeneratorInstance.Result Process(
        in RealtimeContext context, Pipe pipe,
        ChannelBuffer buffer,
        GeneratorInstance.Arguments args)
    {
        // Compute a mono sine and copy it to all channels.
        for (int frame = 0; frame &lt; buffer.frameCount; frame++)
        {
            float s = Mathf.Sin(phase * k_TwoPi);

            for (int ch = 0; ch &lt; buffer.channelCount; ch++)
                buffer[ch, frame] = s;

            // Advance and wrap the phase into [0, 1).
            phase += phaseIncrement;
            if (phase &gt;= 1.0f) phase -= 1.0f;
        }

        // Return the number of frames written.
        return buffer.frameCount;
    }
}
</code></pre>

<p>Next, implement <code>GeneratorInstance.IControl&lt;Realtime&gt;</code>. Use <code>Configure</code> to set any real‑time fields that depend on the format.</p>

<pre><code class="lang-cs">struct Control : GeneratorInstance.IControl&lt;Realtime&gt;
{
    private const float k_Frequency = 440.0f; // A4

    // Dispose is called when the generator instance is destroyed.
    public void Dispose(ControlContext context, ref Realtime realtime) { }

    // Control-side tick; e.g., poll external state or schedule events.
    public void Update(ControlContext context, Pipe pipe) { }

    // Optional message hook; return `Unhandled` for messages you don't consume.
    public Response OnMessage(ControlContext context, Pipe pipe, Message message) =&gt; Response.Unhandled;

    // Called initially when constructed and additionally when the system changes configuration.
    public void Configure(
        ControlContext context,
        ref Realtime realtime,
        in AudioFormat format,
        out GeneratorInstance.Setup setup,
        ref GeneratorInstance.Properties properties)
    {
        // Configure real-time fields that depend on the audio format.
        realtime.phaseIncrement = k_Frequency / format.sampleRate; // cycles/sample

        // Prefer matching the host's format when possible to avoid conversion.
        setup = new GeneratorInstance.Setup(format.speakerMode, format.sampleRate);
    }
}
</code></pre>

<p>Finally, tie everything together in a <code>MonoBehaviour</code> that implements <code>IAudioGenerator</code>:</p>

<pre><code class="lang-cs">public class Driver : MonoBehaviour, IAudioGenerator
{
    public bool isFinite =&gt; false;
    public bool isRealtime =&gt; false;
    public DiscreteTime? length =&gt; null;

    public GeneratorInstance CreateInstance(
        ControlContext context,
        AudioFormat? nestedConfiguration,
        CreationParameters creationParameters)
    {
        // Allocate a new generator instance pairing the realtime and control structs.
        return context.AllocateGenerator(new Realtime(), new Control(), nestedConfiguration, creationParameters);
    }
}
</code></pre>

<p>Finally, add the <code>SineGeneratorDriver</code> component to a <code>GameObject</code>, assign it as the <code>Generator</code> in the <code>AudioSource</code>, and enter Play Mode to hear the sine tone.</p>

<h2>Part II — Configure the frequency</h2>

<p>To parameterize the frequency of the sine generator, start by adding a <code>frequency</code> field to the driver. Then, send frequency updates to the real-time part using the pipe in the <code>Update</code> method, using a lightweight value type to represent frequency change messages:</p>

<pre><code class="lang-cs">// Small value-type message for the pipe.
readonly struct FrequencyEvent
{
    public readonly float value;
    public FrequencyEvent(float value) =&gt; this.value = value;
}
</code></pre>

<p>Secondly, update the real‑time struct to store <code>frequency</code> and <code>sampleRate</code>. In the <code>Update</code> method, read any pending <code>FrequencyEvent</code> message from the pipe, and update the frequency. This approach ensures the audio thread safely handles any number of pending events without throwing errors on the audio thread. The phase increment is then calculated per audio block based on the current frequency and sample rate.</p>

<pre><code class="lang-cs">[BurstCompile(CompileSynchronously = true)]
struct Realtime : GeneratorInstance.IRealtime
{
    private const float k_TwoPi = 2.0f * Mathf.PI;

    private float phase;       // [0, 1)
    internal float frequency;  // Hz, set from control messages
    internal float sampleRate; // Hz, set from Configure

    public bool isFinite =&gt; false;
    public bool isRealtime =&gt; false;
    public DiscreteTime? length =&gt; null;

    public void Update(UpdatedDataContext context, Pipe pipe)
    {
        // Iterate over all available events (newer overwrite older).
        foreach (var element in pipe.GetAvailableData(context))
        {
            if (element.TryGetData(out FrequencyEvent evt))
            {
                frequency = evt.value;
            }

            // Ignore other message types gracefully.
        }
    }

    public GeneratorInstance.Result Process(
        in RealtimeContext context,
        Pipe pipe,
        ChannelBuffer buffer,
        GeneratorInstance.Arguments args)
    {
        // Compute increment locally from current control values.
        float phaseIncrement = frequency / sampleRate;

        for (int frame = 0; frame &lt; buffer.frameCount; frame++)
        {
            float s = Mathf.Sin(phase * k_TwoPi);

            for (int ch = 0; ch &lt; buffer.channelCount; ch++)
                buffer[ch, frame] = s;

            phase += phaseIncrement;
            if (phase &gt;= 1.0f) phase -= 1.0f;
        }

        return buffer.frameCount;
    }
}
</code></pre>

<p>In the control struct, capture the runtime <code>sampleRate</code> in <code>Configure</code> and set up a mono output. Intercept messages sent via the instance and forward them to the real-time part.</p>

<pre><code class="lang-cs">struct Control : GeneratorInstance.IControl&lt;Realtime&gt;
{
    public void Dispose(ControlContext context, ref Realtime realtime) { }

    public void Update(ControlContext context, Pipe pipe) { }

    public Response OnMessage(ControlContext context, Pipe pipe, Message message)
    {
        if (message.Is&lt;FrequencyEvent&gt;())
        {
            pipe.SendData(context, message.Get&lt;FrequencyEvent&gt;());

            return Response.Handled;
        }

        return Response.Unhandled;
    }

    public void Configure(
        ControlContext context,
        ref Realtime realtime,
        in AudioFormat format,
        out GeneratorInstance.Setup setup,
        ref GeneratorInstance.Properties properties)
    {
        realtime.sampleRate = format.sampleRate;

        setup = new GeneratorInstance.Setup(AudioSpeakerMode.Mono, format.sampleRate);
    }
}
</code></pre>

<p>Finally, add a frequency slider and update the audio instance only when the value changes to avoid spamming the control part.</p>

<p>
<strong>Note</strong>: Always guard accesses to the instance. It may be missing or have been destroyed, if the <span class="tooltip"><strong>audio source</strong><span class="tooltiptext">A component which plays back an Audio Clip in the scene to an audio listener or through an audio mixer. <a class="tooltipMoreInfoLink" aria-label="Navigate to more info about class-AudioSource.html" href="class-AudioSource.html">More info</a><br/><span class="tooltipGlossaryLink">See in <a href="Glossary.html#AudioSource" aria-label="Go to glossary anchor for AudioSource">Glossary</a></span></span></span> was stopped elsewhere.</p>

<pre><code class="lang-cs">public class Driver : MonoBehaviour, IAudioGenerator
{
    private AudioSource m_AudioSource;

    [Range(100f, 10000f)]
    public float frequency = 440.0f; // A4

    private float m_PreviousFrequency;

    public bool isFinite =&gt; false;
    public bool isRealtime =&gt; false;
    public DiscreteTime? length =&gt; null;

    public GeneratorInstance CreateInstance(
        ControlContext context,
        AudioFormat? nestedConfiguration,
        CreationParameters creationParameters)
        =&gt; context.AllocateGenerator(new Realtime(), new Control());

    private void Awake()
    {
        // Expects an AudioSource on the same GameObject.
        m_AudioSource = GetComponent&lt;AudioSource&gt;();
    }

    private void Update()
    {
        // Early out if unchanged (use Approximate to avoid redundant updates).
        if (Mathf.Approximately(frequency, m_PreviousFrequency))
            return;

        // Access the instance via the AudioSource.
        var instance = m_AudioSource.generatorInstance;

        // Guard the handle: instance may be missing or have been destroyed, if the audio source was stopped elsewhere.
        if (!ControlContext.builtIn.Exists(instance))
            return;

        var message = new FrequencyEvent(frequency);

        // Send frequency change to the control side.
        ControlContext.builtIn.SendMessage(instance, ref message);
        m_PreviousFrequency = frequency;
    }
}
</code></pre>
<div id="_content"></div>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a aria-label="go to the previous page" href="audio-scriptable-processors-root-outputs.html"></a></span><div class="tip">Root Outputs</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a aria-label="go to the next page" href="audio-scriptable-processors-example-creating-a-root-output.html"></a></span><div class="tip">Example: Create a root output</div>
</div>
</div>
</div>
<div class="footer-wrapper"><div class="footer clear">
<div class="copy">Copyright ©2005-2026 Unity Technologies. All rights reserved. Built from job ID 63949192. Built on: 2026-02-25.</div>
<div class="menu">
<a href="https://learn.unity.com/">Tutorials</a><a href="https://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="https://forum.unity3d.com">Forums</a><a href="https://unity3d.com/asset-store">Asset Store</a><a href="https://docs.unity3d.com/Manual/TermsOfUse.html">Terms of use</a><a href="https://unity.com/legal">Legal</a><a href="https://unity.com/legal/privacy-policy">Privacy Policy</a><a href="https://unity.com/legal/cookie-policy">Cookies</a><a href="https://unity.com/legal/do-not-sell-my-personal-information">Do Not Sell or Share My Personal Information</a><div id="ot-sdk-btn-container"><a id="ot-sdk-btn" class="ot-sdk-show-settings" href="javascript:void(0);">Your Privacy Choices (Cookie Settings)</a></div>
</div>
</div></div>
</div></div></div>
</div>
</body>
</html>
